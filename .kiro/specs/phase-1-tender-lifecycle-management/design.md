# Phase 1: Core Foundation - Tender Lifecycle Management Design

## Overview

The Tender Lifecycle Management feature serves as the core MVP functionality of Tender Track 360, providing essential tender tracking from creation to completion. The design uses Next.js with Better Auth for authentication, PostgreSQL/Neon for data storage, and UploadThing for file management, focusing on rapid deployment and core business value.

## Architecture

### System Architecture

The MVP follows a simplified layered architecture:

- **Presentation Layer**: Next.js React components with Tailwind CSS styling
- **Authentication Layer**: Better Auth for user management and sessions
- **API Layer**: Next.js Server Actions for server-side operations
- **Business Logic Layer**: Simplified service classes for core tender operations
- **Data Access Layer**: Drizzle ORM with PostgreSQL (local) / Neon (production)
- **File Storage Layer**: UploadThing for document management

### Database Design

The MVP uses a simplified schema focusing on core functionality:

- **Better Auth Integration**: User authentication tables auto-generated by Better Auth
- **Core Tender Table**: Essential fields for tender management
- **Basic Status Tracking**: Simple status field with validation
- **File References**: UploadThing file URLs stored in tender documents table
- **Organization Structure**: Files organized by organization folders in UploadThing

## Components and Interfaces

### Core Components

#### TenderService

```typescript
interface TenderService {
  createTender(data: CreateTenderRequest): Promise<Tender>;
  updateTender(id: string, data: UpdateTenderRequest): Promise<Tender>;
  getTender(id: string): Promise<Tender | null>;
  listTenders(filters: TenderFilters): Promise<PaginatedTenders>;
  updateStatus(id: string, status: TenderStatus, userId: string): Promise<void>;
  assignUsers(tenderId: string, userIds: string[]): Promise<void>;
}
```

#### TenderRepository

```typescript
interface TenderRepository {
  create(tender: NewTender): Promise<Tender>;
  findById(id: string): Promise<Tender | null>;
  findMany(filters: TenderFilters): Promise<Tender[]>;
  update(id: string, updates: Partial<Tender>): Promise<Tender>;
  delete(id: string): Promise<void>;
}
```

#### StatusTransitionService

```typescript
interface StatusTransitionService {
  validateTransition(
    fromStatus: TenderStatus,
    toStatus: TenderStatus,
    userRole: UserRole
  ): boolean;
  getValidTransitions(
    currentStatus: TenderStatus,
    userRole: UserRole
  ): TenderStatus[];
  recordTransition(
    tenderId: string,
    fromStatus: TenderStatus,
    toStatus: TenderStatus,
    userId: string
  ): Promise<void>;
}
```

### React Components

#### TenderForm

- Handles creation and editing of tender records
- Implements form validation using react-hook-form and Zod
- Supports file upload for tender documents
- Provides real-time validation feedback

#### TenderList

- Displays paginated list of tenders with filtering and sorting
- Implements search functionality across multiple fields
- Shows status indicators and deadline warnings
- Supports bulk operations for status updates

#### TenderDetail

- Comprehensive view of individual tender information
- Displays status history and audit trail
- Shows assigned team members and their roles
- Provides quick actions for status updates and assignments

#### StatusBadge

- Visual representation of tender status
- Color-coded based on status type and urgency
- Shows transition indicators for status changes

## Data Models

### Extended Tender Model

```typescript
interface Tender {
  id: string;
  referenceNumber: string;
  title: string;
  description?: string;
  clientId: string;
  categoryId?: string;
  status: TenderStatus;
  publicationDate?: Date;
  submissionDeadline?: Date;
  evaluationDate?: Date;
  awardDate?: Date;
  estimatedValue?: number;
  actualValue?: number;
  isSuccessful?: boolean;
  department?: string;
  notes?: string;
  tags: string[];
  assignedUsers: TenderAssignment[];
  documents: TenderDocument[];
  statusHistory: StatusTransition[];
  createdAt: Date;
  updatedAt: Date;
  createdBy: User;
  updatedBy: User;
}
```

### TenderAssignment Model

```typescript
interface TenderAssignment {
  id: string;
  tenderId: string;
  userId: string;
  role: AssignmentRole;
  assignedAt: Date;
  assignedBy: string;
  isActive: boolean;
}
```

### StatusTransition Model

```typescript
interface StatusTransition {
  id: string;
  tenderId: string;
  fromStatus: TenderStatus;
  toStatus: TenderStatus;
  transitionDate: Date;
  userId: string;
  notes?: string;
  isSystemGenerated: boolean;
}
```

## Error Handling

### Validation Errors

- Client-side validation using Zod schemas
- Server-side validation for all data mutations
- User-friendly error messages with specific field feedback
- Graceful handling of network errors with retry mechanisms

### Business Logic Errors

- Status transition validation with clear error messages
- Duplicate reference number prevention
- Permission-based operation restrictions
- Deadline validation ensuring logical date sequences

### Database Errors

- Connection failure handling with fallback mechanisms
- Transaction rollback for failed operations
- Constraint violation handling with user-friendly messages
- Optimistic locking for concurrent updates

## Testing Strategy

### Unit Testing

- Service layer methods with mocked dependencies
- Utility functions for date calculations and validations
- Status transition logic validation
- Data transformation functions

### Integration Testing

- Database operations with test database
- API endpoints with request/response validation
- File upload and document management
- Email notification system

### Component Testing

- React component rendering with various props
- Form submission and validation flows
- User interaction scenarios
- Responsive design across device sizes

### End-to-End Testing

- Complete tender lifecycle workflows
- User permission and role-based access
- Multi-user collaboration scenarios
- Deadline notification and reminder systems

## Performance Considerations

### Database Optimization

- Indexed queries on frequently searched fields (status, deadline, client)
- Pagination for large tender lists
- Efficient joins for related data fetching
- Query optimization for dashboard aggregations

### Caching Strategy

- Server-side caching for frequently accessed tender data
- Client-side caching for user preferences and static data
- Cache invalidation on data updates
- Optimistic updates for better user experience

### File Handling

- Efficient document upload with progress indicators
- Thumbnail generation for document previews
- CDN integration for document delivery
- File size and type validation

## Security Considerations

### Access Control

- Role-based permissions for tender operations
- Row-level security for multi-tenant scenarios
- API endpoint protection with authentication
- Audit logging for all sensitive operations

### Data Protection

- Encryption for sensitive tender information
- Secure file storage with access controls
- Input sanitization and SQL injection prevention
- CSRF protection for form submissions

### Privacy Compliance

- Data retention policies for completed tenders
- User consent management for notifications
- Audit trail for data access and modifications
- Secure deletion of sensitive information
