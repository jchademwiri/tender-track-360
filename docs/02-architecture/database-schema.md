# Database Schema

## Overview
This document outlines the database schema for Tender Track 360, implemented with PostgreSQL and accessed via Drizzle ORM. The schema is designed to support all core functionality while maintaining data integrity, performance, and scalability.

## Entity Relationship Diagram
*Note: Create an ERD using a database modeling tool and include the image or link here.*

## Tables

### users
Stores user account information and is managed by Supabase Auth with additional custom fields.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | uuid | PRIMARY KEY | User ID (generated by Supabase Auth) |
| email | varchar(255) | NOT NULL, UNIQUE | User's email address |
| full_name | varchar(255) | | User's full name |
| role | varchar(50) | NOT NULL | User role (admin, tender_officer, viewer) |
| department | varchar(100) | | User's department |
| is_active | boolean | NOT NULL, DEFAULT true | Whether the user account is active |
| last_login_at | timestamp | | Timestamp of last login |
| created_at | timestamp | NOT NULL, DEFAULT now() | When the record was created |
| updated_at | timestamp | NOT NULL, DEFAULT now() | When the record was last updated |

### tenders
Stores the main tender information.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | serial | PRIMARY KEY | Unique tender ID |
| reference_number | varchar(100) | NOT NULL | Official tender reference number |
| title | varchar(255) | NOT NULL | Tender title |
| description | text | | Detailed tender description |
| department | varchar(100) | | Government department issuing the tender |
| value | decimal(15,2) | | Estimated tender value |
| status | varchar(50) | NOT NULL | Current status (draft, submitted, under_evaluation, awarded, rejected) |
| publication_date | date | | When the tender was published |
| submission_deadline | timestamp | | Deadline for tender submission |
| evaluation_date | date | | Expected evaluation date |
| award_date | date | | Date when award decision is expected |
| outcome | varchar(50) | | Final outcome (awarded, rejected, canceled) |
| outcome_notes | text | | Notes about the outcome |
| created_by | uuid | FOREIGN KEY | Reference to user who created the record |
| assigned_to | uuid | FOREIGN KEY | Reference to user responsible for the tender |
| created_at | timestamp | NOT NULL, DEFAULT now() | When the record was created |
| updated_at | timestamp | NOT NULL, DEFAULT now() | When the record was last updated |

### documents
Stores metadata about uploaded documents.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | serial | PRIMARY KEY | Unique document ID |
| tender_id | integer | FOREIGN KEY, NOT NULL | Reference to associated tender |
| name | varchar(255) | NOT NULL | Document name |
| type | varchar(100) | NOT NULL | Document type (application_form, supporting_doc, feedback, etc.) |
| file_path | varchar(255) | NOT NULL | Path to file in storage |
| file_size | integer | NOT NULL | Size of file in bytes |
| mime_type | varchar(100) | NOT NULL | MIME type of the file |
| version | integer | NOT NULL, DEFAULT 1 | Document version number |
| uploaded_by | uuid | FOREIGN KEY, NOT NULL | Reference to user who uploaded the document |
| uploaded_at | timestamp | NOT NULL, DEFAULT now() | When the document was uploaded |

### notes
Stores notes and comments related to tenders.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | serial | PRIMARY KEY | Unique note ID |
| tender_id | integer | FOREIGN KEY, NOT NULL | Reference to associated tender |
| content | text | NOT NULL | Note content |
| created_by | uuid | FOREIGN KEY, NOT NULL | Reference to user who created the note |
| created_at | timestamp | NOT NULL, DEFAULT now() | When the note was created |

### tasks
Stores tasks related to tenders.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | serial | PRIMARY KEY | Unique task ID |
| tender_id | integer | FOREIGN KEY, NOT NULL | Reference to associated tender |
| title | varchar(255) | NOT NULL | Task title |
| description | text | | Detailed task description |
| due_date | timestamp | | Task due date |
| status | varchar(50) | NOT NULL, DEFAULT 'pending' | Task status (pending, in_progress, completed) |
| assigned_to | uuid | FOREIGN KEY | Reference to user assigned to the task |
| created_by | uuid | FOREIGN KEY, NOT NULL | Reference to user who created the task |
| created_at | timestamp | NOT NULL, DEFAULT now() | When the task was created |
| updated_at | timestamp | NOT NULL, DEFAULT now() | When the task was last updated |

### notifications
Stores system notifications.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | serial | PRIMARY KEY | Unique notification ID |
| user_id | uuid | FOREIGN KEY, NOT NULL | User to notify |
| tender_id | integer | FOREIGN KEY | Associated tender (if applicable) |
| title | varchar(255) | NOT NULL | Notification title |
| message | text | NOT NULL | Notification message |
| type | varchar(50) | NOT NULL | Type of notification (deadline, status_change, assignment, etc.) |
| is_read | boolean | NOT NULL, DEFAULT false | Whether the notification has been read |
| created_at | timestamp | NOT NULL, DEFAULT now() | When the notification was created |

### tender_history
Tracks changes to tenders for audit purposes.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | serial | PRIMARY KEY | Unique history entry ID |
| tender_id | integer | FOREIGN KEY, NOT NULL | Reference to associated tender |
| field | varchar(100) | NOT NULL | Field that was changed |
| old_value | text | | Previous value |
| new_value | text | | New value |
| changed_by | uuid | FOREIGN KEY, NOT NULL | Reference to user who made the change |
| changed_at | timestamp | NOT NULL, DEFAULT now() | When the change was made |

## Indexes

| Table | Index Name | Columns | Type | Purpose |
|-------|------------|---------|------|---------|
| tenders | idx_tenders_status | status | BTREE | Optimize filtering by status |
| tenders | idx_tenders_submission_deadline | submission_deadline | BTREE | Optimize deadline queries |
| documents | idx_documents_tender_id | tender_id | BTREE | Optimize document lookup by tender |
| notes | idx_notes_tender_id | tender_id | BTREE | Optimize note lookup by tender |
| tasks | idx_tasks_status | status | BTREE | Optimize filtering by task status |
| tasks | idx_tasks_assigned_to | assigned_to | BTREE | Optimize finding tasks by assignee |
| notifications | idx_notifications_user_id | user_id | BTREE | Optimize finding notifications by user |
| notifications | idx_notifications_is_read | is_read | BTREE | Optimize filtering by read status |

## Relationships

### One-to-Many
- User to Tenders (created_by)
- User to Tenders (assigned_to)
- User to Documents (uploaded_by)
- User to Notes (created_by)
- User to Tasks (created_by)
- User to Tasks (assigned_to)
- User to Notifications (user_id)
- Tender to Documents
- Tender to Notes
- Tender to Tasks
- Tender to TenderHistory

## Drizzle Schema Definition

```typescript
// Example of how the schema will be defined in Drizzle

import { 
  pgTable, 
  serial, 
  uuid, 
  varchar, 
  text, 
  timestamp, 
  boolean, 
  integer, 
  date, 
  decimal 
} from 'drizzle-orm/pg-core';

export const users = pgTable('users', {
  id: uuid('id').primaryKey(),
  email: varchar('email', { length: 255 }).notNull().unique(),
  fullName: varchar('full_name', { length: 255 }),
  role: varchar('role', { length: 50 }).notNull(),
  department: varchar('department', { length: 100 }),
  isActive: boolean('is_active').notNull().default(true),
  lastLoginAt: timestamp('last_login_at'),
  createdAt: timestamp('created_at').notNull().defaultNow(),
  updatedAt: timestamp('updated_at').notNull().defaultNow()
});

export const tenders = pgTable('tenders', {
  id: serial('id').primaryKey(),
  referenceNumber: varchar('reference_number', { length: 100 }).notNull(),
  title: varchar('title', { length: 255 }).notNull(),
  description: text('description'),
  department: varchar('department', { length: 100 }),
  value: decimal('value', { precision: 15, scale: 2 }),
  status: varchar('status', { length: 50 }).notNull(),
  publicationDate: date('publication_date'),
  submissionDeadline: timestamp('submission_deadline'),
  evaluationDate: date('evaluation_date'),
  awardDate: date('award_date'),
  outcome: varchar('outcome', { length: 50 }),
  outcomeNotes: text('outcome_notes'),
  createdBy: uuid('created_by').references(() => users.id),
  assignedTo: uuid('assigned_to').references(() => users.id),
  createdAt: timestamp('created_at').notNull().defaultNow(),
  updatedAt: timestamp('updated_at').notNull().defaultNow()
});

// Additional table definitions would follow...