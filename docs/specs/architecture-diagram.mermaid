sequenceDiagram
    participant User as User (Browser)
    participant Server as Next.js Server
    participant DB as Neon DB (Postgres)
    participant R2 as Cloudflare R2 (Storage)

    Note over User, R2: 1. File Upload Flow
    User->>Server: Request Upload URL (filename, type)
    Server-->>User: Return Presigned URL (PutObject)
    User->>R2: Upload File (Directly via Presigned URL)
    R2-->>User: 200 OK
    User->>Server: Save Metadata (fileKey, name, size)
    Server->>DB: UPDATE tender SET documents = [...]
    DB-->>Server: Success
    Server-->>User: File Saved!

    Note over User, R2: 2. File Download Flow
    User->>Server: Request Download Link (fileKey)
    Server->>DB: Check User Permissions & File Existence
    DB-->>Server: User is Authorized
    Server->>Server: Generate Presigned URL (GetObject)
    Server-->>User: Redirect (302) to R2 URL
    User->>R2: Download File (via Signed URL)
    R2-->>User: Stream File Content
